# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Airtable ‚Äî –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–î–∞—Ç–∞**: 1 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º—ã**: –û—à–∏–±–∫–∞ SQLSTATE + Airtable 422 + –Ω–µ–≤–µ—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–û—à–∏–±–∫–∞ SQLSTATE: no such column: prefecture_ru** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –Ω–µ –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `pois`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
curl "https://www.konstructour.com/api/migrate-poi-schema.php"

# –ó–∞–ø—É—Å—Ç–∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—é –ª–æ–∫–∞–ª—å–Ω–æ
php api/migrate-poi-schema.php
```

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏:**
- ‚úÖ `prefecture_ru` (TEXT)
- ‚úÖ `prefecture_en` (TEXT)
- ‚úÖ `categories_ru` (TEXT) - JSON –º–∞—Å—Å–∏–≤
- ‚úÖ `categories_en` (TEXT) - JSON –º–∞—Å—Å–∏–≤
- ‚úÖ `description_ru` (TEXT)
- ‚úÖ `description_en` (TEXT)
- ‚úÖ `website` (TEXT)
- ‚úÖ `working_hours` (TEXT)
- ‚úÖ `notes` (TEXT)

### 2. **–û—à–∏–±–∫–∞ Airtable 422: INVALID_RECORD_ID** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ record ID –¥–ª—è linked records
- `"test-city"` –∏ `"test-region"` –Ω–µ —è–≤–ª—è—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º–∏ Airtable ID

**–†–µ—à–µ–Ω–∏–µ:**
```php
// –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è record ID
if (!empty($data['city_id']) && preg_match('/^rec[A-Za-z0-9]{14}$/', $data['city_id'])) {
    $airtableFields['City Location'] = [$data['city_id']];
}

if (!empty($data['region_id']) && preg_match('/^rec[A-Za-z0-9]{14}$/', $regionId)) {
    $airtableFields['Regions'] = [$regionId];
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ ID –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
- ‚úÖ Linked records –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö ID
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 422 –æ—Ç Airtable

### 3. **–û—à–∏–±–∫–∞ Airtable 422: INVALID_MULTIPLE_CHOICE_OPTIONS** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ Airtable
- `"Attraction"` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ dropdown –æ–ø—Ü–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ Airtable

**–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ Airtable:**
```json
// RU –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
["–ë—É–¥–¥–∏–π—Å–∫–∏–π —Ö—Ä–∞–º", "–õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π —Å–∞–¥ / –ü–∞—Ä–∫", "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –º–µ—Å—Ç–æ"]

// EN –∫–∞—Ç–µ–≥–æ—Ä–∏–∏  
["Buddhist Temple", "Historical Location", "Park/Garden"]
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ **–£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ POI:**

```json
{
  "ok": true,
  "message": "POI saved successfully",
  "id": "rec662357a3df274e49",
  "business_id": "POI-000002",
  "tickets_saved": 0,
  "airtable_synced": true,
  "airtable_response": {
    "records": [{
      "id": "recIGIoNuT992wfJW",
      "createdTime": "2025-10-01T13:40:41.000Z",
      "fields": {
        "POI ID": "POI-000002",
        "POI Name (RU)": "–¢–µ—Å—Ç–æ–≤—ã–π POI 5",
        "POI Name (EN)": "Test POI 5",
        "Prefecture (EN)": "Tokyo",
        "Prefecture (RU)": "–¢–æ–∫–∏–æ",
        "POI Category (EN)": ["Buddhist Temple"],
        "POI Category (RU)": ["–ë—É–¥–¥–∏–π—Å–∫–∏–π —Ö—Ä–∞–º"],
        "Working Hours": "9:00-18:00",
        "Description (EN)": "Test description 5",
        "Description (RU)": "–¢–µ—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ 5",
        "Website": "https://example.com",
        "Notes": "–¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–º–µ—Ç–∫–∏ 5"
      }
    }]
  }
}
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–í–∞–ª–∏–¥–∞—Ü–∏—è Airtable record ID**
```php
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç record ID (rec + 14 —Å–∏–º–≤–æ–ª–æ–≤)
preg_match('/^rec[A-Za-z0-9]{14}$/', $recordId)
```

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π**
```php
// –¢–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ Airtable
"categories_ru": ["–ë—É–¥–¥–∏–π—Å–∫–∏–π —Ö—Ä–∞–º", "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –º–µ—Å—Ç–æ"]
"categories_en": ["Buddhist Temple", "Historical Location"]
```

### 3. **–£—Å–ª–æ–≤–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ linked records**
```php
// Linked records –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö ID
if (validRecordId($cityId)) {
    $airtableFields['City Location'] = [$cityId];
}
```

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î:**
```bash
php api/simple-check-fields.php
```

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Airtable:**
```bash
curl "https://www.konstructour.com/api/debug-airtable.php"
```

### 3. **–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è POI:**
```bash
curl -X POST "https://www.konstructour.com/api/save-poi.php" \
  -H "Content-Type: application/json" \
  -d '{"name_ru": "–¢–µ—Å—Ç", "name_en": "Test", ...}'
```

## üìã –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π

### RU –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
- –ë—É–¥–¥–∏–π—Å–∫–∏–π —Ö—Ä–∞–º
- –õ–∞–Ω–¥—à–∞—Ñ—Ç–Ω—ã–π —Å–∞–¥ / –ü–∞—Ä–∫  
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ –º–µ—Å—Ç–æ

### EN –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
- Buddhist Temple
- Historical Location
- Park/Garden

## üéâ –ò—Ç–æ–≥–∏

**–í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã:**
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∞** ‚Äî –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ **Airtable 422 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è record ID
- ‚úÖ **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç** ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–ø—Ü–∏–∏
- ‚úÖ **POI —Å–æ–∑–¥–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ** ‚Äî –ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å POI —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å!** üöÄ

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é**: ‚úÖ –î–∞
