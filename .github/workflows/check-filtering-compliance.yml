name: Check Filtering.md Compliance

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  check-compliance:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        
    - name: Check Filtering.md compliance
      run: |
        echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è Filtering.md..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
        TEST_FILES=$(find . -name "test-*.php" -o -name "create-test-*.php" -o -name "sample-*.php" -o -name "mock-*.php" | grep -v node_modules | grep -v .git)
        if [ ! -z "$TEST_FILES" ]; then
          echo "‚ùå –ù–∞–π–¥–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã:"
          echo "$TEST_FILES"
          exit 1
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ data-api.php –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä—è–º—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ Airtable
        if grep -q "AirtableDataSource\|getRegionsFromAirtable\|api.airtable.com" api/data-api.php; then
          echo "‚ùå data-api.php —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä—è–º—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ Airtable"
          exit 1
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å enforce-filtering.php
        if [ ! -f "api/enforce-filtering.php" ]; then
          echo "‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç api/enforce-filtering.php"
          exit 1
        fi
        
        echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
