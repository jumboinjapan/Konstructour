# User Stories & Business Flows for Constructour (2025)

В исходном анализе было отмечено, что прежние документы описывали UI и код, но не объясняли *почему* и *как* пользователь будет работать с системой【534680704413190†L551-L579】. Без описания бизнес‑потоков сложно понять, какие требования важны, и как связаны модули. Настоящий документ вводит сценарии использования и описывает типичные процессы в приложении Constructour.

## 1 Роли и акторы

- **Гид/менеджер** — основной пользователь системы, который собирает информацию от клиента, создаёт программу тура, редактирует её и отправляет клиенту.
- **Клиент (турист)** — потенциальный путешественник, который заполняет анкету, оценивает предложенную программу и оплачивает услуги (функция вне MVP).
- **Администратор** — владелец/модератор сервиса, который управляет общими настройками, правами доступа и интеграциями.

## 2 Сценарии использования

Ниже приведены ключевые пользовательские истории в формате «Как [роль], я хочу [цель], чтобы [результат]»:

1. **Создание клиента:**
   - *Как гид*, я хочу добавить нового клиента с контактами и предпочтениями, чтобы система могла учесть его запросы при планировании тура.
2. **Заполнение анкеты:**
   - *Как клиент*, я хочу заполнить многошаговую анкету (даты поездки, состав группы, бюджет, опыт, интересы), чтобы гид получил все необходимые данные для индивидуального маршрута.
3. **Настройка ценовых коэффициентов:**
   - *Как гид*, я хочу указать коэффициенты стоимости (цены гида, транспорта, билетов, запас времени), чтобы автоматически рассчитывать бюджет тура.
4. **Создание и редактирование тура:**
   - *Как гид*, я хочу создать тур, автоматически сгенерировать дни по диапазону дат и редактировать каждый день (города, объекты, время, сопровождение), чтобы программа соответствовала пожеланиям клиента.
5. **Генерация маршрута на основе шаблонов:**
   - *Как гид*, я хочу автоматизированно заполнить подневной план на основе похожих туров, чтобы сэкономить время и получить идеи от ИИ.
6. **Просмотр и отправка программы:**
   - *Как гид*, я хочу увидеть превью программы (PDF) перед отправкой клиенту, чтобы проверить корректность и внести правки.
7. **Получение обратной связи:**
   - *Как клиент*, я хочу просмотреть предложенную программу и оставить комментарии или запросить изменения, чтобы маршрут был полностью согласован.
8. **Экспорт и обмен:**
   - *Как гид*, я хочу скачать PDF программы или отправить ссылку клиенту, чтобы удобнее поделиться маршрутом.
9. **Администрирование:**
   - *Как администратор*, я хочу управлять правами доступа, интеграциями (Airtable, платежи, CRM) и просматривать сводную статистику по турам.

## 3 Бизнес‑процессы

### 3.1 Планирование тура

1. **Сбор данных от клиента:** клиент заполняет анкету. Система сохраняет данные и уведомляет гида.
2. **Анализ предпочтений:** гид просматривает анкету, уточняет детали (если требуется) и устанавливает ценовые параметры.
3. **Создание тура:** гид указывает даты и регионы, система генерирует список дней.
4. **Автозаполнение:** гид может использовать функцию ИИ для автозаполнения на основе похожих туров (см. `ai_workflow_constructour_2025.md`).
5. **Ручное редактирование:** гид добавляет/редактирует объекты, время и сопровождение. Используется drag‑and‑drop для упорядочивания.
6. **Просмотр черновика:** гид проверяет предварительное превью и вносит правки.
7. **Утверждение и экспорт:** гид формирует окончательную версию и отправляет клиенту ссылку или PDF.
8. **Обратная связь:** клиент предоставляет комментарии; гид вносит корректировки (повтор шагов 5–7) до согласования.

### 3.2 Управление клиентами и оплатами

Этот процесс выходит за рамки базового MVP, но предусматривает следующие шаги:
1. Клиент подтверждает программу и выбирает пакет услуг.
2. Система генерирует счёт (инвойс) и предлагает способы оплаты.
3. После оплаты обновляется статус тура (e.g., `confirmed`), и гид бронирует необходимые услуги.

## 4 Диаграммы и дополнения

Для визуализации бизнес‑процессов можно использовать BPMN‑диаграммы или простые flowchart‑схемы. Это поможет AI‑ассистентам и разработчикам быстрее понять последовательность шагов. В рамках Markdown допускается использовать ASCII‑схемы:

```
Анкета клиента → [генерация тура] → редактирование → превью → отправка → отзыв клиента
                        ↘ автозаполнение ИИ ↗
```

Такой подход демонстрирует, что автозаполнение является необязательным шагом, но может ускорить процесс. При необходимости создавайте более подробные схемы в инструментах вроде Draw.io или Mermaid.

## 5 Заключение

Определение ролей и сценариев использования помогает сфокусировать разработку на реальных потребностях пользователей. Этот документ служит связующим звеном между техническими требованиями и пользовательским опытом. Обновляйте истории по мере расширения функциональности (например, добавления модуля бронирования отелей или интеграции с авиакомпаниями).